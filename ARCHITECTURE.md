# ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è¯´æ˜

## æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç¡¬ä»¶å±‚ (Hardware)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  RPLIDAR (æ¿€å…‰é›·è¾¾)          å…¨å‘è½®å°è½¦ (STM32ä¸‹ä½æœº)              â”‚
â”‚  â†“ USB/ä¸²å£                  â†‘ ä¸²å£ (/dev/ttyUSB0)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“                    â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ROS2 èŠ‚ç‚¹å±‚ (Nodes)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  sllidar_node    â”‚â”€â”€â”€â”€â”€â”€â”€â†’â”‚ obstacle_distance_monitorâ”‚       â”‚
â”‚  â”‚  (é›·è¾¾é©±åŠ¨)       â”‚ /scan  â”‚  (éšœç¢ç‰©ç›‘æµ‹)             â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚          â”‚                              â”‚                        â”‚
â”‚          â”‚ /scan                        â”‚ /obstacle_distance     â”‚
â”‚          â†“                              â†“                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚       Cartographer (SLAMå»ºå›¾)                     â”‚           â”‚
â”‚  â”‚  - è®¢é˜…: /scan                                    â”‚           â”‚
â”‚  â”‚  - å‘å¸ƒ: /map, /submap_list                      â”‚           â”‚
â”‚  â”‚  - TF: mapâ†’odomâ†’base_linkâ†’laser                 â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚          â”‚                                                        â”‚
â”‚          â”‚ /map, TF                                              â”‚
â”‚          â†“                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚     Navigation2 (è·¯å¾„è§„åˆ’ä¸é¿éšœ)                   â”‚           â”‚
â”‚  â”‚  - å…¨å±€è§„åˆ’å™¨: NavFn/SmacPlanner                 â”‚           â”‚
â”‚  â”‚  - å±€éƒ¨è§„åˆ’å™¨: DWB Controller                    â”‚           â”‚
â”‚  â”‚  - ä»£ä»·åœ°å›¾: Global/Local Costmap                â”‚           â”‚
â”‚  â”‚  - è¡Œä¸ºæ ‘: Navigate to Pose                      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚          â”‚                         â†‘                             â”‚
â”‚          â”‚ /cmd_vel               â”‚ /goal_pose                  â”‚
â”‚          â†“                         â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ omnidirectional_ â”‚      â”‚  manual_goal_setter  â”‚            â”‚
â”‚  â”‚   controller     â”‚      â”‚   (æ‰‹åŠ¨ç›®æ ‡è®¾ç½®)      â”‚            â”‚
â”‚  â”‚ (å…¨å‘è½®æ§åˆ¶å™¨)    â”‚      â”‚  - é¢„è®¾ç›®æ ‡ç‚¹         â”‚            â”‚
â”‚  â”‚  - é€Ÿåº¦è½¬æ¢       â”‚      â”‚  - å·¡èˆªæ¨¡å¼          â”‚            â”‚
â”‚  â”‚  - CRCæ ¡éªŒ        â”‚      â”‚  - æœåŠ¡æ¥å£          â”‚            â”‚
â”‚  â”‚  - ä¸²å£é€šä¿¡       â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚          â”‚ ä¸²å£æ•°æ®                                               â”‚
â”‚          â†“                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â†“ 11å­—èŠ‚åè®® (AA 55 + é€Ÿåº¦ + CRC)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸‹ä½æœº (STM32)                                 â”‚
â”‚  - CRCæ ¡éªŒ                                                        â”‚
â”‚  - å…¨å‘è½®è¿åŠ¨å­¦è§£ç®—                                               â”‚
â”‚  - 4ä¸ªéº¦å…‹çº³å§†è½®ç”µæœºæ§åˆ¶                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•°æ®æµè¯¦è§£

### 1ï¸âƒ£ æ„ŸçŸ¥æ•°æ®æµ
```
RPLIDARç¡¬ä»¶ 
  â†’ sllidar_node (å‘å¸ƒ/scan: LaserScan)
    â†’ Cartographer (è®¢é˜…/scan, ç”Ÿæˆåœ°å›¾)
      â†’ å‘å¸ƒ /map (OccupancyGrid)
      â†’ å‘å¸ƒ TFæ ‘ (mapâ†’odom)
    â†’ obstacle_distance_monitor (è®¢é˜…/scan)
      â†’ å‘å¸ƒ /obstacle_distance (Float32)
      â†’ æ—¥å¿—è¾“å‡ºæœ€è¿‘è·ç¦»
```

### 2ï¸âƒ£ å¯¼èˆªæŒ‡ä»¤æµ
```
ç”¨æˆ·è¾“å…¥ (RViz2ç‚¹å‡» æˆ– æœåŠ¡è°ƒç”¨)
  â†’ manual_goal_setter (å¤„ç†ç›®æ ‡ç‚¹æœåŠ¡)
    â†’ å‘å¸ƒ /goal_pose (PoseStamped)
      â†’ Navigation2 (è·¯å¾„è§„åˆ’)
        â†’ å‘å¸ƒ /cmd_vel (Twist)
          â†’ omnidirectional_controller (é€Ÿåº¦è½¬æ¢)
            â†’ ä¸²å£å‘é€ 11å­—èŠ‚æ•°æ®åŒ…
              â†’ STM32ä¸‹ä½æœº (ç”µæœºæ§åˆ¶)
                â†’ å…¨å‘è½®è¿åŠ¨
```

### 3ï¸âƒ£ TFå˜æ¢æ ‘
```
map (å…¨å±€åœ°å›¾åæ ‡ç³»)
 â””â”€ odom (é‡Œç¨‹è®¡åæ ‡ç³», ç”±Cartographerå‘å¸ƒ)
     â””â”€ base_link (æœºå™¨äººåº•ç›˜ä¸­å¿ƒ, é™æ€å˜æ¢)
         â””â”€ laser (æ¿€å…‰é›·è¾¾åæ ‡ç³», é™æ€å˜æ¢)
```

---

## å…³é”®è¯é¢˜ (Topics)

| è¯é¢˜å | ç±»å‹ | å‘å¸ƒè€… | è®¢é˜…è€… | è¯´æ˜ |
|--------|------|--------|--------|------|
| `/scan` | LaserScan | sllidar_node | Cartographer, obstacle_monitor | æ¿€å…‰æ‰«ææ•°æ® |
| `/map` | OccupancyGrid | Cartographer | Navigation2 | å æ®æ …æ ¼åœ°å›¾ |
| `/goal_pose` | PoseStamped | manual_goal_setter | Navigation2 | ç›®æ ‡ç‚¹ |
| `/cmd_vel` | Twist | Navigation2 | omnidirectional_controller | é€Ÿåº¦æŒ‡ä»¤ |
| `/obstacle_distance` | Float32 | obstacle_monitor | (å¯é€‰è®¢é˜…) | æœ€è¿‘éšœç¢ç‰©è·ç¦» |

---

## å…³é”®æœåŠ¡ (Services)

| æœåŠ¡å | ç±»å‹ | æä¾›è€… | åŠŸèƒ½ |
|--------|------|--------|------|
| `/set_goal_0` | Trigger | manual_goal_setter | å‰å¾€é¢„è®¾ç‚¹0 |
| `/set_goal_1` | Trigger | manual_goal_setter | å‰å¾€é¢„è®¾ç‚¹1 |
| `/set_goal_2` | Trigger | manual_goal_setter | å‰å¾€é¢„è®¾ç‚¹2 |
| `/set_goal_3` | Trigger | manual_goal_setter | å‰å¾€é¢„è®¾ç‚¹3 |
| `/start_patrol` | Trigger | manual_goal_setter | å¼€å§‹å·¡èˆª |
| `/cancel_goal` | Trigger | manual_goal_setter | å–æ¶ˆå¯¼èˆª |

---

## å‚æ•°é…ç½®

### sllidar_node
- `serial_port`: "/dev/ttyUSB0"
- `serial_baudrate`: 115200 (A1/A2M8)
- `frame_id`: "laser"
- `angle_compensate`: true

### Cartographer
- `use_imu_data`: false (æ— IMUæ¨¡å¼)
- `num_accumulated_range_data`: 10
- `map_frame`: "map"
- `tracking_frame`: "base_link"

### omnidirectional_controller
- `serial_port`: "/dev/ttyUSB0"
- `baudrate`: 115200
- `max_linear_vel`: 1.0 m/s
- `max_angular_vel`: 1.5 rad/s

---

## åæ ‡ç³»å®šä¹‰

```
     Y (å‰æ–¹)
     â†‘
     â”‚
     â”‚
     â””â”€â”€â”€â”€â†’ X (å³ä¾§)
    /
   /
  â†™ Z (é€†æ—¶é’ˆä¸ºæ­£)

base_link: æœºå™¨äººä¸­å¿ƒ
laser: é›·è¾¾ä¸­å¿ƒ (ç›¸å¯¹base_linkåç§»)
```

å…¨å‘è½®é€Ÿåº¦æ˜ å°„ï¼š
- `cmd_vel.linear.x` â†’ Yæ–¹å‘é€Ÿåº¦ (å‰å)
- `cmd_vel.linear.y` â†’ Xæ–¹å‘é€Ÿåº¦ (å·¦å³)
- `cmd_vel.angular.z` â†’ Zæ—‹è½¬é€Ÿåº¦ (è‡ªè½¬)

---

## é€šä¿¡åè®®ç»†èŠ‚

### ä¸Šä½æœºâ†’ä¸‹ä½æœº (11å­—èŠ‚)

```
å­—èŠ‚ç´¢å¼•  â”‚ 0  â”‚ 1  â”‚ 2-3  â”‚ 4-5  â”‚ 6-7  â”‚ 8  â”‚ 9-10 â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
å†…å®¹     â”‚0xAAâ”‚0x55â”‚ Vx   â”‚ Vy   â”‚ Wz   â”‚0x00â”‚ CRC  â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
å­—èŠ‚åº   â”‚    â”‚    â”‚ LE   â”‚ LE   â”‚ LE   â”‚    â”‚ LE   â”‚
æ•°æ®ç±»å‹ â”‚    â”‚    â”‚int16 â”‚int16 â”‚int16 â”‚    â”‚uint16â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜

LE = Little Endian (å°ç«¯åº)
```

### æ•°å€¼è½¬æ¢å…¬å¼
```cpp
// ROSé€Ÿåº¦ â†’ åè®®æ•°å€¼
int16_t vx_protocol = (int16_t)(cmd_vel.linear.y * 1000);   // m/s â†’ mm/s
int16_t vy_protocol = (int16_t)(cmd_vel.linear.x * 1000);   // m/s â†’ mm/s
int16_t wz_protocol = (int16_t)(cmd_vel.angular.z * 572.96); // rad/s â†’ Â°/s*10
```

### CRC-16/MODBUSç®—æ³•
```cpp
uint16_t calculateCRC16(const uint8_t* data, size_t length) {
    uint16_t crc = 0xFFFF;
    for (size_t i = 0; i < length; i++) {
        crc ^= data[i];
        for (int j = 0; j < 8; j++) {
            if (crc & 0x0001) {
                crc = (crc >> 1) ^ 0xA001;
            } else {
                crc >>= 1;
            }
        }
    }
    return crc;
}
```

---

## èŠ‚ç‚¹å¯åŠ¨é¡ºåº

### æ¨èå¯åŠ¨é¡ºåº
1. **ç¡¬ä»¶å‡†å¤‡**ï¼šè¿æ¥é›·è¾¾å’Œä¸‹ä½æœºï¼Œæ£€æŸ¥ä¸²å£æƒé™
2. **SLAMå±‚**ï¼šsllidar_node â†’ Cartographer
3. **ç›‘æµ‹å±‚**ï¼šobstacle_distance_monitor
4. **å¯¼èˆªå±‚**ï¼šNavigation2 (å¯é€‰)
5. **æ§åˆ¶å±‚**ï¼šomnidirectional_controller
6. **äº¤äº’å±‚**ï¼šmanual_goal_setter, RViz2

### ä¾èµ–å…³ç³»
- Cartographer **ä¾èµ–** `/scan` è¯é¢˜
- omnidirectional_controller **ä¾èµ–** `/cmd_vel` è¯é¢˜
- manual_goal_setter **ç‹¬ç«‹è¿è¡Œ** (å¯å•ç‹¬ä½¿ç”¨)
- obstacle_monitor **ä¾èµ–** `/scan` è¯é¢˜

---

## æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | å…¸å‹å€¼ | è¯´æ˜ |
|------|--------|------|
| æ¿€å…‰æ‰«æé¢‘ç‡ | 10 Hz | RPLIDAR A1 |
| åœ°å›¾æ›´æ–°é¢‘ç‡ | ~1 Hz | Cartographer |
| æ§åˆ¶æŒ‡ä»¤é¢‘ç‡ | 10-20 Hz | Navigation2 |
| ä¸²å£é€šä¿¡é¢‘ç‡ | ä¸cmd_velåŒæ­¥ | æŒ‰éœ€å‘é€ |
| éšœç¢ç‰©ç›‘æµ‹é¢‘ç‡ | 10 Hz | ä¸æ¿€å…‰åŒæ­¥ |

---

## æ•…éšœæ¢å¤æœºåˆ¶

1. **ä¸²å£è‡ªåŠ¨é‡è¿**ï¼šæ–­çº¿åæ¯5ç§’é‡è¯•
2. **CRCæ ¡éªŒ**ï¼šæ•°æ®åŒ…å®Œæ•´æ€§éªŒè¯
3. **é€Ÿåº¦é™å¹…**ï¼šé˜²æ­¢è¶…é€ŸæŒ‡ä»¤
4. **è¶…æ—¶ä¿æŠ¤**ï¼šåœæ­¢æŒ‡ä»¤è¶…æ—¶è‡ªåŠ¨åœè½¦
5. **TFè¶…æ—¶**ï¼šå¯¼èˆªå¤±è´¥è‡ªåŠ¨åœæ­¢

---

## æ‰©å±•æ¥å£

### æ·»åŠ æ–°ä¼ æ„Ÿå™¨
1. åˆ›å»ºæ–°çš„èŠ‚ç‚¹å‘å¸ƒä¼ æ„Ÿå™¨æ•°æ®
2. æ›´æ–°Cartographeré…ç½®è®¢é˜…æ–°è¯é¢˜
3. ä¿®æ”¹TFæ ‘æ·»åŠ æ–°åæ ‡ç³»

### æ·»åŠ æ–°åŠŸèƒ½
1. åœ¨ `navigation_control/src/` åˆ›å»ºæ–°èŠ‚ç‚¹
2. åœ¨ `CMakeLists.txt` æ·»åŠ ç¼–è¯‘ç›®æ ‡
3. åœ¨ `launch/` åˆ›å»ºå¯åŠ¨æ–‡ä»¶
4. æ›´æ–°æ–‡æ¡£

---

**å®Œæ•´ç³»ç»Ÿå·²å…·å¤‡SLAMå»ºå›¾ã€è·¯å¾„è§„åˆ’ã€éšœç¢ç‰©ç›‘æµ‹ã€æ‰‹åŠ¨æ§åˆ¶å’Œå…¨å‘è½®é©±åŠ¨åŠŸèƒ½ï¼** ğŸ¯
